import{f as N,ab as O,u as R,I as x,$ as K,q as v,g as C,a1 as S,l as P,K as T,i as z,j as I,R as q,a2 as V,X as D,_ as E,d as y,b as n,w as m,r as _,o as g,m as $,ac as w,a as F,t as k}from"../index83433.js";const B={setup(){N(()=>{p.value=!0,e.value={first:0,rows:s.value.rows,sortField:null,sortOrder:null,filters:u.value};const a=localStorage.getItem("dt-companies");if(e.value.page==null&&a){let r=JSON.parse(a);e.value.first=r.first,e.value.page=r.first/e.value.rows}O.register("myfilter",(r,A)=>r===A),f()});const c=R(),o=x(),M=K(),s=v(),u=v({name:{value:"",matchMode:"contains"},email:{value:"",matchMode:"contains"},pec:{value:"",matchMode:"contains"},vat:{value:"",matchMode:"contains"},referral_user:{value:"",matchMode:"contains"}}),p=v(!0),e=v(),d=v(0),h=v([{label:"My Filter",value:"myfilter"}]),t=C(()=>c.getters[V.CURRENT_COMPANIES]),i=C(()=>c.getters[D.CURRENT_REQUEST_STATUSES]),l=a=>{I.push({name:"dettaglio-azienda",params:{id:a.data.id}})};function f(){p.value=!0;const a=new Map;a.set("name",u.value.name.value),a.set("email",u.value.email.value),a.set("pec",u.value.pec.value),a.set("referral_user",u.value.referral_user.value),a.set("page",e.value.page+1),a.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?a.set("sorted_by",e.value.sortField+"_asc"):a.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{b(a)},Math.random()*1e3+250)}const b=async function(a){try{const r=await c.dispatch(S.FETCH_ALL_COMPANIES,a);return p.value=!1,r}catch(r){P(c),T(o,r)}},U=async function(a){await c.dispatch(S.DELETE_COMPANY,a).then(()=>{q(o,{message:"Azienda eliminata correttamente.",title:""}),f()}).catch(r=>{T(o,r)})};return{dt:s,requests:t,filters:u,loading:p,totalRecords:d,lazyParams:e,loadLazyData:f,matchModes:h,requests_status:i,onPage:a=>{e.value=a,f()},onSort:a=>{e.value=a,f()},onFilter:()=>{e.value.page=0,e.value.filters=u.value,f()},onRowSelect:l,confirmDeleteCompany:(a,r)=>{M.require({target:a.currentTarget,message:"Sei sicuro di voler eliminare questa azienda?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{U(r)}})},moment:z}}};function L(c,o,M,s,u,p){const e=_("InputText"),d=_("Column"),h=_("DataTable");return g(),y("div",null,[n(h,{value:s.requests.companies,lazy:!0,paginator:!0,rows:30,filters:s.filters,"onUpdate:filters":o[0]||(o[0]=t=>s.filters=t),ref:"dt",dataKey:"id",totalRecords:s.requests.total,loading:s.loading,onPage:o[1]||(o[1]=t=>s.onPage(t)),onSort:o[2]||(o[2]=t=>s.onSort(t)),onFilter:o[3]||(o[3]=t=>s.onFilter()),filterDisplay:"row",selectionMode:"single",onRowSelect:s.onRowSelect,stateStorage:"local",stateKey:"dt-companies",removableSort:""},{empty:m(()=>[$(" Nessuna azienda trovata. ")]),default:m(()=>[n(d,{field:"name",header:"Ragione sociale",filterMatchMode:"startsWith",ref:"name",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:i})=>[n(e,{type:"text",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,onKeydown:w(l=>i(),["enter"]),class:"p-column-filter",placeholder:"Ricerca per nome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"vat",header:"P.IVA",filterMatchMode:"startsWith",ref:"vat",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:i})=>[n(e,{type:"text",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,onKeydown:w(l=>i(),["enter"]),class:"p-column-filter",placeholder:"Ricerca per P.IVA"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"email",header:"Email",filterField:"email",ref:"email",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:i})=>[n(e,{type:"text",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,onKeydown:w(l=>i(),["enter"]),class:"p-column-filter",placeholder:"Ricerca per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"pec",header:"PEC",filterField:"pec",ref:"pec",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:i})=>[n(e,{type:"text",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,onKeydown:w(l=>i(),["enter"]),class:"p-column-filter",placeholder:"Ricerca per pec"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"referral_user",header:"Referente",filterMatchMode:"startsWith",ref:"referral_user",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:i})=>[n(e,{type:"text",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,onKeydown:w(l=>i(),["enter"]),class:"p-column-filter",placeholder:"Ricerca per referente"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512)]),_:1},8,["value","filters","totalRecords","loading","onRowSelect"])])}const W=E(B,[["render",L]]),Y={setup(){const c=R();return{companies:C(()=>c.getters[V.CURRENT_COMPANIES])}},components:{CompaniesTable:W}},j={class:"request m-4"},G={class:"flex justify-content-between align-items-center"},Q={class:"uppercase"},H={key:0},J={key:1};function X(c,o,M,s,u,p){const e=_("Button"),d=_("CompaniesTable"),h=_("Card");return g(),y("div",j,[n(h,null,{content:m(()=>[F("div",G,[F("h1",Q,[s.companies.total==1?(g(),y("span",H," 1 Azienda")):(g(),y("span",J,k(s.companies.total)+" Aziende",1))]),n(e,{label:"Nuova azienda",onClick:o[0]||(o[0]=t=>c.$router.push("/dettaglio-azienda"))})]),n(d)]),_:1})])}const le=E(Y,[["render",X]]);export{le as default};
