import{q as A,u as M,I as z,s as I,T as S,R as U,l as q,K as Y,_ as x,c as Q,w as f,r as m,o as h,a as l,b as s,d as C,U as j,V as W,e as w,m as E,t as T,E as G,f as L,H as F,g as H,$ as Z,ad as K,i as J,O as X,Y as B,L as N,ae as ee,af as oe,Z as te}from"../index83433.js";const ne={setup(){const t=A(!1),o=M(),u=z(),e=A(new Array),g=()=>{t.value=!0},p=()=>{t.value=!1},d=async function(r){const n=new FormData;I(o),n.append("file",r.files[0]);const R={formData:n};try{const D=await o.dispatch(S.UPLOAD_NEW_LEAD_TO_REQUEST,R);return e.value=[],U(u,{message:"Documento caricato correttamente.",title:""}),a(),p(),q(o),D}catch(D){q(o),Y(u,D)}},a=async function(){I(o);try{const r=await o.dispatch(S.FETCH_ALL_DRAFT_PRODUCTS_REQUEST);return q(o),r}catch{q(o)}};return{displayBasic:t,documents:e,openBasic:g,closeBasic:p,uploadDocuments:d,formatSize:r=>{if(r===0)return"0 B";let n=1e3,R=3,D=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],k=Math.floor(Math.log(r)/Math.log(n));return parseFloat((r/Math.pow(n,k)).toFixed(R))+" "+D[k]},onSelectedFiles:r=>{e.value=r.files},onRemoveTempDocument:function(r){e.value.splice(r,1)}}}},se={class:"flex justify-content-between align-items-center"},ae=l("h1",{class:"m-0"},"CARICA NUOVI LEAD",-1),le=l("a",{href:"https://sircredit.s3-eu-central-1.amazonaws.com/template_caricament_lead.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi download-document-icon"},[l("i",{class:"pi download-document-icon mr-2"}),E(" TEMPLATE ")],-1),ie={key:0,class:"m-0 p-0 list-none"},ce={class:"flex align-items-center"},re=l("i",{class:"pi mr-2 document-icon"},null,-1),de=l("br",null,null,-1),me=["onClick"],ue=l("div",{class:"text-center"},[l("b",null,"Trascina qui il documento"),l("p",{class:"text-xs"},"(Dimensione massima 20 MB)")],-1);function _e(t,o,u,e,g,p){const d=m("Button"),a=m("FileUpload"),b=m("Dialog"),v=m("Card");return h(),Q(v,{class:"mt-3"},{content:f(()=>[l("div",se,[ae,l("div",null,[le,s(d,{class:"",label:"carica",icon:"pi pi-upload",onClick:e.openBasic},null,8,["onClick"]),s(b,{header:"CARICA NUOVI LEAD",visible:e.displayBasic,"onUpdate:visible":o[2]||(o[2]=_=>e.displayBasic=_),style:{width:"400px"}},{default:f(()=>[s(a,{name:"documents[]",onUploader:o[0]||(o[0]=_=>e.uploadDocuments(_)),multiple:!1,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:2e6,customUpload:!0,modelValue:e.documents,"onUpdate:modelValue":o[1]||(o[1]=_=>e.documents=_),onSelect:e.onSelectedFiles},{content:f(()=>[e.documents?(h(),C("ul",ie,[(h(!0),C(j,null,W(e.documents,(_,r)=>(h(),C("li",{key:_.name,class:"flex align-items-center p-fileupload-file justify-content-between"},[l("div",ce,[re,E(" "+T(_.name),1),de,E(" "+T(e.formatSize(_.size)),1)]),l("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold",onClick:n=>e.onRemoveTempDocument(r)},null,8,me)]))),128))])):w("",!0)]),empty:f(()=>[ue]),_:1},8,["modelValue","onSelect"])]),_:1},8,["visible"])])])]),_:1})}const pe=x(ne,[["render",_e]]),fe={setup(){const t=G("dialogRef"),o=A(),u=A();return L(()=>{o.value=t.value.data.draft_request}),{request:o,selectedRequest:u,closeDialog:function(g,p){const d={request_id:p,contact_id:g};t.value.close(d)}}}};const he={class:"ml-0 px-0 py-3"},Ce={key:0,class:"border-round-md bg-primary col-4 py-3 px-4 mb-5"},ve=l("h2",{class:"mb-2 text-500"},"ANAGRAFICA IMPORTATA",-1),ge={class:"flex flex-column text-500"},be={class:"mb-0"},ye={class:"mb-0"},Te={class:"mb-0"},Re={class:"flex justify-content-between align-items-center generic-filters border-round-md p-3 py-3 my-2 flex-wrap"},De=l("div",{class:"col-12 lg:col-7 md:col-6"}," I seguenti contatti hanno dei dati simili al contatto importato. Selezionando uno dei contatti sottostanti verranno utilizzate le informazioni del contatto selezionato. ",-1),we={key:1,class:"col-12"};function Ee(t,o,u,e,g,p){const d=m("Button"),a=m("Column"),b=m("DataTable");return h(),C("div",he,[e.request?(h(),C("div",Ce,[ve,l("div",ge,[l("p",be,"Nome: "+T(e.request.contact_last_name),1),l("p",ye,"Telefono: "+T(e.request.contact_phone||"-"),1),l("p",Te,"Email: "+T(e.request.contact_email||"-"),1)])])):w("",!0),l("div",Re,[De,l("div",null,[s(d,{class:"p-button mr-4 p-button-outlined",label:"mantieni anagrafica",onClick:o[0]||(o[0]=v=>e.closeDialog(null,null))}),s(d,{class:"",label:"usa l'anagrafica selezionata",onClick:o[1]||(o[1]=v=>e.closeDialog(e.selectedRequest.id,e.request.id)),disabled:!e.selectedRequest},null,8,["disabled"])])]),e.request?(h(),C("div",we,[s(b,{value:e.request.old_contact_data,lazy:!0,rows:30,ref:"dt",dataKey:"id",selectionMode:"single",selection:e.selectedRequest,"onUpdate:selection":o[2]||(o[2]=v=>e.selectedRequest=v)},{empty:f(()=>[E(" Nessun dato inserito. ")]),default:f(()=>[s(a,{selectionMode:"single",headerStyle:"width: 3rem"}),s(a,{field:"name",header:"Nome"}),s(a,{field:"phone",header:"Telefono",ref:"phone"},null,512),s(a,{field:"phone_2",header:"Telefono 2",ref:"phone_2"},null,512),s(a,{field:"phone_2_note",header:"Note",ref:"phone_2_note"},null,512),s(a,{field:"phone_3",header:"Telefono 3",ref:"phone_3"},null,512),s(a,{field:"phone_3_note",header:"Note",ref:"phone_3_note"},null,512),s(a,{field:"email",header:"Email",ref:"email"},null,512)]),_:1},8,["value","selection"])])):w("",!0)])}const Se=x(fe,[["render",Ee]]),Ae=F({setup(){L(()=>{o()});const t=H(()=>u.getters[X.CURRENT_DRAFT_PRODUCT_REQUEST]),o=async function(){try{const c=await u.dispatch(S.FETCH_ALL_DRAFT_PRODUCTS_REQUEST);return e.value=!1,c}catch{}},u=M(),e=A(!0),g=Z(),p=A(),d=K(),a=z(),b=c=>{c.type!="checkbox"&&(p.value=[])},v=function(){const c=[];if(p.value)for(let i of p.value)c.push(i.id);return c},_=function(c,i){return c?i.semaphore_email&&i.semaphore_phone?"red":i.semaphore_email||i.semaphore_phone?"orange":"yellow":""},r=function(c,i){return c?i.semaphore_name&&i.semaphore_phone?"red":i.semaphore_name||i.semaphore_phone?"orange":"yellow":""},n=function(c,i){return c?i.semaphore_name&&i.semaphore_email?"red":i.semaphore_name||i.semaphore_email?"orange":"yellow":""},R=c=>{g.require({header:"Manda in produzione",target:c.currentTarget,message:"Sei sicuro di voler importare questi lead?",icon:"pi pi-info-circle",acceptClass:"p-button-primary",accept:()=>{D()}})},D=async function(){let c={product_request_ids:v()};try{const i=await u.dispatch(S.CONFIRM_IMPORT,c);return e.value=!1,U(a,{message:"I contatti selezionati sono stati importati",title:"Importazione completata"}),o(),i}catch{}},k=(c,i)=>{d.open(Se,{props:{header:"SELEZIONA L'ANAGRAFICA DA UTILIZZARE",modal:!0,style:{width:"80vw"},breakpoints:{"1440px":"98vw"}},data:{draft_request:i},onClose:y=>{y&&y.data&&P(y==null?void 0:y.data)}})},O=c=>{g.require({header:"Elimina lead",target:c.currentTarget,message:"Sei sicuro di voler eliminare questi lead?",icon:"pi pi-info-circle",acceptClass:"p-button-primary",accept:()=>{V()}})},P=async function(c){let i={contact_id:c.contact_id,request_id:c.request_id};try{const y=await u.dispatch(S.MERGE_CONTACT,i);return e.value=!1,U(a,{message:"I contatti selezionati sono stati importati",title:"Importazione completata"}),o(),y}catch{}},V=async function(){let c={product_request_ids:v()};try{const i=await u.dispatch(S.DELETE_DRAFT_PRODUCT_REQUESTS,c);return e.value=!1,U(a,{message:"Lead eliminati correttamente.",title:""}),o(),i}catch{}};return{requests:t,moment:J,selectedCheckboxRow:p,setColorName:_,setColorEmail:r,setColorPhone:n,confirmImport:R,openDialogMerge:k,confirmDelete:O,onRowSelect:b}}});const $=t=>(ee("data-v-747282bd"),t=t(),oe(),t),ke={class:"flex align-items-center justify-content-between"},qe=$(()=>l("h1",null,"SALA D'ATTESA",-1)),Ue=["onClick"],xe={key:0,class:"pi join-icon"},Be={key:1,class:"pi circle-tick-icon"},Ne={key:0},Ie={key:0},Me=$(()=>l("br",null,null,-1));function ze(t,o,u,e,g,p){const d=m("Button"),a=m("Column"),b=m("DataTable"),v=m("ConfirmDialog"),_=m("DynamicDialog"),r=te("tooltip");return h(),C("div",null,[l("div",ke,[qe,l("div",null,[s(d,{class:"p-button mr-4 p-button-outlined",label:"elimina",onClick:t.confirmDelete,disabled:!t.selectedCheckboxRow||t.selectedCheckboxRow.length<1},null,8,["onClick","disabled"]),s(d,{class:"",label:"manda in produzione",onClick:t.confirmImport,disabled:!t.selectedCheckboxRow||t.selectedCheckboxRow.length<1},null,8,["onClick","disabled"])])]),s(b,{value:t.requests,lazy:!0,rows:30,ref:"dt",dataKey:"id",selectionMode:"multiple",selection:t.selectedCheckboxRow,"onUpdate:selection":o[0]||(o[0]=n=>t.selectedCheckboxRow=n),onRowSelect:o[1]||(o[1]=n=>t.onRowSelect(n))},{empty:f(()=>[E(" Nessun dato inserito. ")]),default:f(()=>[s(a,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(a,{field:"semaphore_name",header:"Corrispondenza",style:{width:"180px"}},{body:f(({data:n})=>[B(l("div",{class:N([t.setColorName(n.semaphore_name,n),"circle"])},null,2),[[r,"Nome",void 0,{top:!0}]]),B(l("div",{class:N([t.setColorEmail(n.semaphore_email,n),"circle"])},null,2),[[r,"Email",void 0,{top:!0}]]),B(l("div",{class:N([t.setColorPhone(n.semaphore_phone,n),"circle"])},null,2),[[r,"Telefono",void 0,{top:!0}]])]),_:1}),s(a,{field:"",header:"",style:{width:"80px"}},{body:f(({data:n})=>[l("div",{onClick:R=>t.openDialogMerge(R,n),class:"confirm-merge"},[!n.contact_id&&(n.semaphore_name||n.semaphore_phone||n.semaphore_email)?(h(),C("i",xe)):w("",!0),n.contact_id!=null?(h(),C("i",Be)):w("",!0)],8,Ue)]),_:1}),s(a,{field:"contact_last_name",header:"Nome",ref:"contact_last_name"},null,512),s(a,{field:"contact_phone",header:"Telefono",ref:"contact_phone"},null,512),s(a,{field:"contact_email",header:"Email",ref:"contact_email"},null,512),s(a,{field:"source",header:"Fonte/campagna",ref:"source"},null,512),s(a,{field:"date",header:"Data e ora acquisizione"},{body:f(({data:n})=>[n.lead_date?(h(),C("div",Ne,T(t.moment(n.lead_date).format("DD/MM/YYYY")),1)):w("",!0)]),_:1}),s(a,{field:"date",header:"Data e ora import"},{body:f(({data:n})=>[n.created_at?(h(),C("div",Ie,[E(T(t.moment.unix(n.created_at).format("DD/MM/YYYY"))+" ",1),Me,E(" "+T(t.moment.unix(n.created_at).format("HH:mm")),1)])):w("",!0)]),_:1})]),_:1},8,["value","selection"]),s(v),s(_)])}const Le=x(Ae,[["render",ze],["__scopeId","data-v-747282bd"]]),Fe=F({setup(){},components:{CardUploadNewLead:pe,WaitingRoomTable:Le}}),$e={class:"m-4"};function Oe(t,o,u,e,g,p){const d=m("CardUploadNewLead"),a=m("WaitingRoomTable"),b=m("Card");return h(),C("div",$e,[s(d),s(b,{class:"mt-4"},{content:f(()=>[s(a)]),_:1})])}const Ve=x(Fe,[["render",Oe]]);export{Ve as default};
