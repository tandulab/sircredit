import{u as M,I,$ as S,i as T,j as F,Q as G,T as K,K as w,_ as Y,c as A,w as k,L as U,e as _,r as m,o as c,a as e,t as h,Y as Z,d as i,m as j,Z as J,g as P,q as y,h as W,s as N,a3 as O,l as q,R as V,a4 as X,b as C}from"../index83433.js";import{A as $}from"./AppointmentCalendar83433.js";const tt={props:{product:Object,icon_delete:Boolean},setup(){const g=M(),n=I(),o=S(),t=async function(a){await g.dispatch(G.DELETE_PRODUCT,a).then(()=>{g.dispatch(K.DELETE_PRDODUCT_FROM_REQUEST,a)}).catch(l=>{w(n,l)})};return{confirmDeleteProduct:(a,l)=>{o.require({target:a.currentTarget,message:"Sei sicuro di voler eliminare questo prodotto?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{t(l)}})},moment:T,goToRequest:function(a){a&&a.product_request_id&&F.push({name:"dettaglio-pratica",params:{id:a.product_request_id}})}}}};const et={class:"col-12 flex justify-content-between align-items-center"},ot={class:"text-color-secondary uppercase mb-1"},at={class:"mr-2"},nt={key:0,class:"pi pi-info-circle text-300 cursor-pointer"},st={key:0,class:"text-color-secondary uppercase mb-1"},ct={class:"col flex align-items-center justify-content-between"},lt={key:0},rt={class:"text-400"},dt={key:1},it=e("b",{class:"text-400"},"Rata mensile -",-1),_t=[it],ut={class:"col flex align-items-center justify-content-end"},mt={class:"text-400"},pt={key:0},ft={key:1};function vt(g,n,o,t,x,b){const a=m("Card"),l=J("tooltip");return o.product?(c(),A(a,{key:0,class:U(["surface-200 product-card",{"cursor-pointer":o.product&&o.product.product_request_id}]),onClick:n[1]||(n[1]=p=>t.goToRequest(o.product))},{content:k(()=>[e("div",et,[e("h2",ot,[e("span",at,h(o.product.company_name),1),o.product.notes?Z((c(),i("i",nt,null,512)),[[l,{value:o.product.notes},void 0,{top:!0}]]):_("",!0)]),o.product.product_request_number?(c(),i("h2",st,h(o.product.product_request_number),1)):_("",!0)]),e("div",ct,[e("span",null,h(o.product.product_type),1),o.product.montly_amount?(c(),i("span",lt,[e("b",rt,"Rata mensile "+h(o.product.montly_amount)+"\u20AC",1)])):(c(),i("span",dt,_t))]),e("div",ut,[e("span",null,[e("b",mt,[j(" Scadenza "),o.product.expiration_date?(c(),i("span",pt,h(t.moment(o.product.expiration_date).format("DD/MM/YYYY")),1)):(c(),i("span",ft," - "))])])]),o.product!=null&&o.icon_delete?(c(),i("i",{key:0,class:"pi delete-icon",onClick:n[0]||(n[0]=p=>t.confirmDeleteProduct(p,o.product?o.product.id+"":""))})):_("",!0)]),_:1},8,["class"])):_("",!0)}const Bt=Y(tt,[["render",vt]]),yt={props:{modelValue:{type:Object,default:()=>({})}},setup(g,{emit:n}){const o=P({get:()=>g.modelValue,set:s=>n("update:modelValue",s)}),t=P(()=>a.getters[X.CURRENT_APPOINTMENT]),x=y([{name:"Appuntamento",code:"Appuntamento"},{name:"Ricontatto",code:"Ricontatto"}]),b=S(),a=M(),l=I(),p=y(!1),D=y(!1),f=y({start_at:"",date:y()}),u=y({start_at:"",date:"",id:""}),v=y(!1),r=()=>{p.value=!0},E=function(){var s,d;return((s=f.value)==null?void 0:s.date)==""||((d=f.value)==null?void 0:d.date)==null?v.value=!0:v.value=!1,v.value},B=async function(s){if(E())return;let d=Object.assign({},s);d.date=T(s.date).format("YYYY-MM-DD"),d.recall="true",d.start_at=T.duration(s.start_at).asMinutes()+"",d.product_request_id=o.value.id,N(a);let z={appointment:d};await a.dispatch(O.CREATE_APPOINTMENT,z).then(()=>{q(a),V(l,{message:"Ricontatto creato correttamente.",title:""}),u.value.id=t.value.id+"",R(t.value),f.value={start_at:"",date:""}}).catch(Q=>{q(a),w(l,Q)})},L=function(s,d){b.require({target:s.currentTarget,message:"Sei sicuro di voler eliminare questo ricontatto?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{H(d)}})},H=async function(s){N(a),await a.dispatch(O.DELETE_APPOINTMENT,s).then(()=>{q(a),V(l,{message:"Appuntamento rimosso correttamente.",title:""}),u.value={start_at:"",date:"",id:""},f.value={start_at:"",date:""}}).catch(d=>{q(a),w(l,d)})},R=function(s){u.value.date=T(s.date).format("DD/MM/YYYY"),u.value.start_at=T.utc().startOf("day").add(s.start_at,"minutes").format("HH:mm")};return W(async()=>{o.value.next_recall&&(u.value.id=o.value.next_recall.id,R(o.value.next_recall))}),{types:x,moment:T,new_product_request:o,displayCalendar:p,renderDialog:D,form:f,next_recall:u,current_appointment:t,invalid_date:v,confirmDeleteAppointment:L,openCalendar:r,createAppointment:B,validateDate:E}},components:{AppointmentCalendar:$}};const ht=e("h2",{class:"mt-0 mb-3"},"AGENDA",-1),gt={class:"formgrid flex"},Ct={class:"flex col-4"},Tt={class:"field col-12 pl-0"},xt=e("label",{for:"request_type"},"Seleziona tipologia",-1),bt={key:0,class:"flex col-8"},Dt={class:"field col-4"},qt=e("label",{for:"end_at"},"Data ricontatto*",-1),At={key:0,id:"end_at",class:"p-error"},kt={class:"field col-3"},wt=e("label",{for:"hour"},"Ora ricontatto",-1),Et={class:"field col-5"},Rt=e("label",{class:"empty-label",for:"add"},"Aggiungi",-1),Pt={class:"flex col-8"},Nt={class:"field col-12 pl-0"},Ot=e("label",{class:"empty-label mt-1",for:"add"},"Aggiungi",-1),Vt={class:"flex justify-content-between column-gap-2 flex-wrap mt-4"},Mt={class:"flex align-items-center justify-content-between"},It=e("h2",{class:"text-color-secondary uppercase m-0"},[e("span",{class:"mr-2"},"RICONTATTO")],-1),St={key:0};function Yt(g,n,o,t,x,b){const a=m("Dropdown"),l=m("Calendar"),p=m("InputMask"),D=m("Button"),f=m("AppointmentCalendar"),u=m("Dialog"),v=m("Card");return c(),A(v,{class:"mt-3"},{content:k(()=>[ht,e("div",gt,[e("div",Ct,[e("div",Tt,[xt,C(a,{options:t.types,optionLabel:"name",optionValue:"code",id:"request_type",class:"w-full",modelValue:t.new_product_request.request_type,"onUpdate:modelValue":n[0]||(n[0]=r=>t.new_product_request.request_type=r)},null,8,["options","modelValue"])])]),t.new_product_request.request_type=="Ricontatto"?(c(),i("div",bt,[e("div",Dt,[qt,C(l,{inputId:"dateformat",modelValue:t.form.date,"onUpdate:modelValue":n[1]||(n[1]=r=>t.form.date=r),dateFormat:"dd/mm/yy",manualInput:!0,class:U({"p-invalid":t.invalid_date}),onBlur:t.validateDate,placeholder:"gg/mm/aaaa"},null,8,["modelValue","class","onBlur"]),t.invalid_date?(c(),i("small",At,"Campo obbligatorio.")):_("",!0)]),e("div",kt,[wt,C(p,{id:"hour",mask:"99:99",modelValue:t.form.start_at,"onUpdate:modelValue":n[2]||(n[2]=r=>t.form.start_at=r),placeholder:"HH:mm",class:"w-full"},null,8,["modelValue"])]),e("div",Et,[Rt,C(D,{id:"add",label:"Aggiungi ricontatto",class:"add-recontact p-button-outlined",onClick:n[3]||(n[3]=r=>t.createAppointment(t.form))})])])):_("",!0),e("div",Pt,[e("div",Nt,[Ot,t.new_product_request.request_type=="Appuntamento"?(c(),A(D,{key:0,label:"Calendario",class:"add-recontact ml-3 p-button-outlined",onClick:t.openCalendar},null,8,["onClick"])):_("",!0)])]),C(u,{header:"",visible:t.displayCalendar,"onUpdate:visible":n[4]||(n[4]=r=>t.displayCalendar=r),style:{width:"60vw",height:"90vh"},class:"calendar-dialog"},{default:k(()=>[C(f,{new_product_request:t.new_product_request},null,8,["new_product_request"])]),_:1},8,["visible"])]),e("div",Vt,[t.next_recall.id?(c(),A(v,{key:0,class:"surface-200 product-card"},{content:k(()=>[e("div",Mt,[It,e("span",null,[j(h(t.next_recall.date)+" ",1),t.next_recall.start_at!="00:00"?(c(),i("span",St,"- "+h(t.next_recall.start_at),1)):_("",!0)])]),e("i",{class:"pi delete-icon",onClick:n[5]||(n[5]=r=>t.confirmDeleteAppointment(r,t.next_recall.id))})]),_:1})):_("",!0)])]),_:1})}const Lt=Y(yt,[["render",Yt]]);export{Bt as C,Lt as a};
